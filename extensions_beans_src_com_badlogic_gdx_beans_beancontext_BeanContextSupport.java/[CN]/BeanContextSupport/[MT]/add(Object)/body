{
  if (child == null) {
    throw new IllegalArgumentException(Messages.getString("beans.67"));
  }
  BeanContextChild proxy=null;
synchronized (globalHierarchyLock) {
    if (contains(child)) {
      return false;
    }
    if (serializing) {
      throw new IllegalStateException(Messages.getString("beans.68"));
    }
    boolean valid=validatePendingAdd(child);
    if (!valid) {
      throw new IllegalStateException(Messages.getString("beans.69"));
    }
    if (child instanceof BeanContextProxy) {
      proxy=((BeanContextProxy)child).getBeanContextProxy();
      if (proxy == null) {
        throw new NullPointerException(Messages.getString("beans.6A"));
      }
    }
    BeanContextChild beanContextChild=getChildBeanContextChild(child);
    BCSChild childBCSC=null, proxyBCSC=null;
synchronized (children) {
      childBCSC=createBCSChild(child,proxy);
      children.put(child,childBCSC);
      if (proxy != null) {
        proxyBCSC=createBCSChild(proxy,child);
        children.put(proxy,proxyBCSC);
      }
    }
    if (beanContextChild != null) {
      try {
        beanContextChild.setBeanContext(getBeanContextPeer());
      }
 catch (      PropertyVetoException e) {
synchronized (children) {
          children.remove(child);
          if (proxy != null) {
            children.remove(proxy);
          }
        }
        throw new IllegalStateException(Messages.getString("beans.6B"));
      }
      beanContextChild.removePropertyChangeListener("beanContext",nonSerPCL);
      beanContextChild.addPropertyChangeListener("beanContext",nonSerPCL);
    }
synchronized (child) {
      addSerializable(childBCSC);
      childJustAddedHook(child,childBCSC);
    }
    if (proxy != null) {
synchronized (proxy) {
        addSerializable(proxyBCSC);
        childJustAddedHook(proxy,proxyBCSC);
      }
    }
  }
  fireChildrenAdded(new BeanContextMembershipEvent(getBeanContextPeer(),proxy == null ? new Object[]{child} : new Object[]{child,proxy}));
  return true;
}
