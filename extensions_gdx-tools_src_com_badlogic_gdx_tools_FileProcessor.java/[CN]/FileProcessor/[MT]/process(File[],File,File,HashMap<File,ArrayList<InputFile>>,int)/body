{
  for (  File file : files) {
    if (file.isFile()) {
      if (inputRegex.size > 0) {
        boolean found=false;
        for (        Pattern pattern : inputRegex) {
          if (pattern.matcher(file.getName()).matches()) {
            found=true;
            continue;
          }
        }
        if (!found)         continue;
      }
      File dir=file.getParentFile();
      if (inputFilter != null && !inputFilter.accept(dir,file.getName()))       continue;
      String outputName=file.getName();
      if (outputSuffix != null)       outputName=outputName.replaceAll("(.*)\\..*","$1") + outputSuffix;
      InputFile inputFile=new InputFile();
      inputFile.depth=depth;
      inputFile.inputFile=file;
      inputFile.outputDir=outputDir;
      inputFile.outputFile=flattenOutput ? new File(outputRoot,outputName) : new File(outputDir,outputName);
      ArrayList<InputFile> inputFiles=dirToEntries.get(dir);
      if (inputFiles == null) {
        inputFiles=new ArrayList();
        dirToEntries.put(dir,inputFiles);
      }
      inputFiles.add(inputFile);
    }
    if (recursive && file.isDirectory())     process(file.listFiles(inputFilter),outputRoot,new File(outputDir,file.getName()),dirToEntries,depth + 1);
  }
}
