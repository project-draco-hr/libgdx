{
  SecureRandom sr=SecureRandom.getInstance("SHA1PRNG");
  String uniqueId=Long.toHexString(sr.nextLong());
  JSONObject purchaseRequest=new JSONObject();
  purchaseRequest.put("uuid",uniqueId);
  purchaseRequest.put("identifier",product.getIdentifier());
  String purchaseRequestJson=purchaseRequest.toString();
  byte[] keyBytes=new byte[16];
  sr.nextBytes(keyBytes);
  SecretKey key=new SecretKeySpec(keyBytes,"AES");
  byte[] ivBytes=new byte[16];
  sr.nextBytes(ivBytes);
  IvParameterSpec iv=new IvParameterSpec(ivBytes);
  Cipher cipher=Cipher.getInstance("AES/CBC/PKCS5Padding","BC");
  cipher.init(Cipher.ENCRYPT_MODE,key,iv);
  byte[] payload=cipher.doFinal(purchaseRequestJson.getBytes("UTF-8"));
  cipher=Cipher.getInstance("RSA/ECB/PKCS1Padding","BC");
  cipher.init(Cipher.ENCRYPT_MODE,ouyaPublicKey);
  byte[] encryptedKey=cipher.doFinal(keyBytes);
  purchasable=new Purchasable(product.getIdentifier(),Base64.encodeToString(encryptedKey,Base64.NO_WRAP),Base64.encodeToString(ivBytes,Base64.NO_WRAP),Base64.encodeToString(payload,Base64.NO_WRAP));
synchronized (ouyaOutstandingPurchaseRequests) {
    ouyaOutstandingPurchaseRequests.put(uniqueId,product);
  }
}
