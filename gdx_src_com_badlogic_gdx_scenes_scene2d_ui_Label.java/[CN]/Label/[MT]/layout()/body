{
  BitmapFont font=cache.getFont();
  float oldScaleX=font.getScaleX();
  float oldScaleY=font.getScaleY();
  if (fontScaleX != 1 || fontScaleY != 1)   font.setScale(fontScaleX,fontScaleY);
  if (sizeInvalid)   computeSize();
  if (wrap) {
    float prefHeight=getPrefHeight();
    if (prefHeight != lastPrefHeight) {
      lastPrefHeight=prefHeight;
      invalidateHierarchy();
    }
  }
  float width=getWidth(), height=getHeight();
  Drawable background=style.background;
  float x=0, y=0;
  if (background != null) {
    x=background.getLeftWidth();
    y=background.getBottomHeight();
    width-=background.getLeftWidth() + background.getRightWidth();
    height-=background.getBottomHeight() + background.getTopHeight();
  }
  if ((labelAlign & Align.top) != 0) {
    y+=cache.getFont().isFlipped() ? 0 : height - bounds.y;
    y+=style.font.getDescent();
  }
 else   if ((labelAlign & Align.bottom) != 0) {
    y+=cache.getFont().isFlipped() ? height - bounds.y : 0;
    y-=style.font.getDescent();
  }
 else   y+=(int)((height - bounds.y) / 2);
  if (!cache.getFont().isFlipped())   y+=bounds.y;
  if ((labelAlign & Align.left) == 0) {
    if ((labelAlign & Align.right) != 0)     x+=width - bounds.x;
 else     x+=(int)((width - bounds.x) / 2);
  }
  layout.setText(font,text,0,text.length,Color.WHITE,(ellipsis && width < bounds.x) ? width : bounds.x,lineAlign,wrap,ellipsis ? "..." : null);
  cache.setText(layout,x,y);
  if (fontScaleX != 1 || fontScaleY != 1)   font.setScale(oldScaleX,oldScaleY);
}
