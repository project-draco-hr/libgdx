{
  BitmapFont font=cache.getFont();
  float oldScaleX=font.getScaleX();
  float oldScaleY=font.getScaleY();
  if (fontScaleX != 1 || fontScaleY != 1)   font.setScale(fontScaleX,fontScaleY);
  if (sizeInvalid)   computeSize();
  if (wrap) {
    float prefHeight=getPrefHeight();
    if (prefHeight != lastPrefHeight) {
      lastPrefHeight=prefHeight;
      invalidateHierarchy();
    }
  }
  float width=getWidth(), height=getHeight();
  StringBuilder text;
  if (ellipsis && width < bounds.width) {
    float ellipseWidth=font.getBounds("...").width;
    text=tempText != null ? tempText : (tempText=new StringBuilder());
    text.setLength(0);
    if (width > ellipseWidth) {
      text.append(this.text,0,font.computeVisibleGlyphs(this.text,0,this.text.length,width - ellipseWidth));
      text.append("...");
    }
  }
 else   text=this.text;
  Drawable background=style.background;
  float x=0, y=0;
  if (background != null) {
    x=background.getLeftWidth();
    y=background.getBottomHeight();
    width-=background.getLeftWidth() + background.getRightWidth();
    height-=background.getBottomHeight() + background.getTopHeight();
  }
  if ((labelAlign & Align.top) != 0) {
    y+=cache.getFont().isFlipped() ? 0 : height - bounds.height;
    y+=style.font.getDescent();
  }
 else   if ((labelAlign & Align.bottom) != 0) {
    y+=cache.getFont().isFlipped() ? height - bounds.height : 0;
    y-=style.font.getDescent();
  }
 else   y+=(int)((height - bounds.height) / 2);
  if (!cache.getFont().isFlipped())   y+=bounds.height;
  if ((labelAlign & Align.left) == 0) {
    if ((labelAlign & Align.right) != 0)     x+=width - bounds.width;
 else     x+=(int)((width - bounds.width) / 2);
  }
  if (wrap)   cache.setWrappedText(text,x,y,bounds.width,lineAlign);
 else   cache.setMultiLineText(text,x,y,bounds.width,lineAlign);
  if (fontScaleX != 1 || fontScaleY != 1)   font.setScale(oldScaleX,oldScaleY);
}
