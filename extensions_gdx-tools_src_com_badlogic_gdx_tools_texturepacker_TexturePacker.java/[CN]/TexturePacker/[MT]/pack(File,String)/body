{
  outputDir.mkdirs();
  for (int i=0, n=settings.scale.length; i < n; i++) {
    imageProcessor.setScale(settings.scale[i]);
    for (    InputImage inputImage : inputImages) {
      if (inputImage.file != null)       imageProcessor.addImage(inputImage.file);
 else       imageProcessor.addImage(inputImage.image,inputImage.name);
    }
    Array<Page> pages=packer.pack(imageProcessor.getImages());
    String scaledPackFileName=settings.getScaledPackFileName(packFileName,i);
    File packFile=new File(outputDir,scaledPackFileName);
    File packDir=packFile.getParentFile();
    packDir.mkdirs();
    writeImages(packFile,pages);
    try {
      writePackFile(packFile,pages);
    }
 catch (    IOException ex) {
      throw new RuntimeException("Error writing pack file.",ex);
    }
    imageProcessor.clear();
  }
}
