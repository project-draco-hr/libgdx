{
  outputDir.mkdirs();
  if (packFileName.indexOf('.') == -1 || packFileName.endsWith(".png") || packFileName.endsWith(".jpg"))   packFileName+=".atlas";
  for (  float scale : settings.scale) {
    String scaledPackFileName=packFileName;
    if (scale != 1 || settings.scale.length != 1) {
      FileHandle file=new FileHandle(scaledPackFileName);
      String suffix=scale == (int)scale ? Integer.toString((int)scale) : Float.toString(scale);
      scaledPackFileName=file.nameWithoutExtension() + suffix + "."+ file.extension();
    }
    imageProcessor.setScale(scale);
    for (    InputImage inputImage : inputImages) {
      if (inputImage.file != null)       imageProcessor.addImage(inputImage.file);
 else       imageProcessor.addImage(inputImage.image,inputImage.name);
    }
    Array<Page> pages=packer.pack(imageProcessor.getImages());
    writeImages(outputDir,pages,scaledPackFileName);
    try {
      writePackFile(outputDir,pages,scaledPackFileName);
    }
 catch (    IOException ex) {
      throw new RuntimeException("Error writing pack file.",ex);
    }
    imageProcessor.clear();
  }
}
