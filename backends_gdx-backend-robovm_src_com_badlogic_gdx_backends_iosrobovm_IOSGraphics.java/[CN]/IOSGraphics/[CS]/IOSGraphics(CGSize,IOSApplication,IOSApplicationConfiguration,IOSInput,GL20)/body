{
  width=(int)bounds.width();
  height=(int)bounds.height();
  app.debug(tag,bounds.width() + "x" + bounds.height()+ ", "+ UIScreen.getMainScreen().getScale());
  this.gl20=gl20;
  context=new EAGLContext(EAGLRenderingAPI.OpenGLES2);
  view=new GLKView(new CGRect(new CGPoint(0,0),bounds),context){
    @Override public void touchesBegan(    NSSet touches,    UIEvent event){
      super.touchesBegan(touches,event);
      IOSGraphics.this.input.touchDown(touches,event);
    }
    @Override public void touchesCancelled(    NSSet touches,    UIEvent event){
      super.touchesCancelled(touches,event);
      IOSGraphics.this.input.touchUp(touches,event);
    }
    @Override public void touchesEnded(    NSSet touches,    UIEvent event){
      super.touchesEnded(touches,event);
      IOSGraphics.this.input.touchUp(touches,event);
    }
    @Override public void touchesMoved(    NSSet touches,    UIEvent event){
      super.touchesMoved(touches,event);
      IOSGraphics.this.input.touchMoved(touches,event);
    }
    @Override public void draw(    CGRect rect){
      IOSGraphics.this.draw(this,rect);
    }
  }
;
  view.setDelegate(this);
  view.setDrawableColorFormat(config.colorFormat);
  view.setDrawableDepthFormat(config.depthFormat);
  view.setDrawableStencilFormat(config.stencilFormat);
  view.setDrawableMultisample(config.multisample);
  viewController=new IOSUIViewController(app,this);
  viewController.setView(view);
  viewController.setDelegate(this);
  viewController.setPreferredFramesPerSecond(60);
  this.app=app;
  this.input=input;
  int r=0, g=0, b=0, a=0, depth=0, stencil=0, samples=0;
  if (config.colorFormat == GLKViewDrawableColorFormat.RGB565) {
    r=5;
    g=6;
    b=5;
    a=0;
  }
 else {
    r=g=b=a=8;
  }
  if (config.depthFormat == GLKViewDrawableDepthFormat.Format16) {
    depth=16;
  }
 else   if (config.depthFormat == GLKViewDrawableDepthFormat.Format24) {
    depth=24;
  }
 else {
    depth=0;
  }
  if (config.stencilFormat == GLKViewDrawableStencilFormat.Format8) {
    stencil=8;
  }
  if (config.multisample == GLKViewDrawableMultisample.Sample4X) {
    samples=4;
  }
  bufferFormat=new BufferFormat(r,g,b,a,depth,stencil,samples,false);
  this.gl20=gl20;
  density=1f;
  float scale=UIScreen.getMainScreen().getScale();
  app.debug(tag,"Calculating density, UIScreen.mainScreen.scale: " + scale);
  if (scale == 2f)   density=2f;
  int ppi;
  if (UIDevice.getCurrentDevice().getUserInterfaceIdiom() == UIUserInterfaceIdiom.Pad) {
    ppi=Math.round(density * 132);
  }
 else {
    ppi=Math.round(density * 163);
  }
  ppiX=ppi;
  ppiY=ppi;
  ppcX=ppiX / 2.54f;
  ppcY=ppiY / 2.54f;
  app.debug(tag,"Display: ppi=" + ppi + ", density="+ density);
  lastFrameTime=System.nanoTime();
  framesStart=lastFrameTime;
  paused=false;
  wasPaused=true;
}
