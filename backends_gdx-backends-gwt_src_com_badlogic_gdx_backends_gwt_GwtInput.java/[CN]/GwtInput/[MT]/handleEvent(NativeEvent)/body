{
  if (e.getType().equals("mousedown")) {
    if (!e.getEventTarget().equals(canvas) || touched) {
      float mouseX=(int)getRelativeX(e,canvas);
      float mouseY=(int)getRelativeY(e,canvas);
      if (mouseX < 0 || mouseX > Gdx.graphics.getWidth() || mouseY < 0 || mouseY > Gdx.graphics.getHeight()) {
        hasFocus=false;
      }
      return;
    }
    hasFocus=true;
    this.justTouched=true;
    this.touched=true;
    this.pressedButtons.add(getButton(e.getButton()));
    this.deltaX=0;
    this.deltaY=0;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=TimeUtils.nanoTime();
    if (processor != null)     processor.touchDown(mouseX,mouseY,0,getButton(e.getButton()));
  }
  if (e.getType().equals("mousemove")) {
    this.deltaX=(int)getRelativeX(e,canvas) - mouseX;
    this.deltaY=(int)getRelativeY(e,canvas) - mouseY;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=TimeUtils.nanoTime();
    if (processor != null) {
      if (touched)       processor.touchDragged(mouseX,mouseY,0);
 else       processor.touchMoved(mouseX,mouseY);
    }
  }
  if (e.getType().equals("mouseup")) {
    if (!touched)     return;
    this.pressedButtons.remove(getButton(e.getButton()));
    this.touched=pressedButtons.size() > 0;
    this.deltaX=(int)getRelativeX(e,canvas) - mouseX;
    this.deltaY=(int)getRelativeY(e,canvas) - mouseY;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=TimeUtils.nanoTime();
    this.touched=false;
    if (processor != null)     processor.touchUp(mouseX,mouseY,0,getButton(e.getButton()));
  }
  if (e.getType().equals("keydown") && hasFocus) {
    System.out.println("keydown");
    int code=keyForCode(e.getKeyCode());
    if (code == 67) {
      e.preventDefault();
      if (processor != null) {
        processor.keyDown(code);
        processor.keyTyped('\b');
      }
    }
 else {
      this.pressedKeys.add(code);
      if (processor != null)       processor.keyDown(code);
    }
  }
  if (e.getType().equals("keypress") && hasFocus) {
    System.out.println("keypress");
    char c=(char)e.getCharCode();
    if (processor != null)     processor.keyTyped(c);
  }
  if (e.getType().equals("keyup") && hasFocus) {
    System.out.println("keyup");
    int code=keyForCode(e.getKeyCode());
    this.pressedKeys.remove(code);
    if (processor != null)     processor.keyUp(code);
  }
}
