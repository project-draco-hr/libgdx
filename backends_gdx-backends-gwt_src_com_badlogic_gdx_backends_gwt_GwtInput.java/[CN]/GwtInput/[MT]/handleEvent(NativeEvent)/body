{
  if (e.getType().equals("mousedown")) {
    if (!e.getEventTarget().equals(canvas) || touched)     return;
    this.justTouched=true;
    this.touched=true;
    this.pressedButtons.add(getButton(e.getButton()));
    this.deltaX=0;
    this.deltaY=0;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=System.currentTimeMillis() * 1000;
    if (processor != null)     processor.touchDown(mouseX,mouseY,0,getButton(e.getButton()));
  }
  if (e.getType().equals("mousemove")) {
    this.deltaX=(int)getRelativeX(e,canvas) - mouseX;
    this.deltaY=(int)getRelativeY(e,canvas) - mouseY;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=System.currentTimeMillis() * 1000;
    if (processor != null) {
      if (touched)       processor.touchDragged(mouseX,mouseY,0);
 else       processor.touchMoved(mouseX,mouseY);
    }
  }
  if (e.getType().equals("mouseup")) {
    if (!touched)     return;
    this.pressedButtons.remove(getButton(e.getButton()));
    this.touched=pressedButtons.size() > 0;
    this.deltaX=(int)getRelativeX(e,canvas) - mouseX;
    this.deltaY=(int)getRelativeY(e,canvas) - mouseY;
    this.mouseX=(int)getRelativeX(e,canvas);
    this.mouseY=(int)getRelativeY(e,canvas);
    this.currentEventTimeStamp=System.currentTimeMillis() * 1000;
    this.touched=false;
    if (processor != null)     processor.touchUp(mouseX,mouseY,0,getButton(e.getButton()));
  }
  if (e.getType().equals("keydown")) {
    int code=keyForCode(e.getKeyCode());
    this.pressedKeys.add(code);
    if (processor != null)     processor.keyDown(code);
  }
  if (e.getType().equals("keypress")) {
    char c=(char)e.getCharCode();
    if (processor != null)     processor.keyTyped(c);
  }
  if (e.getType().equals("keyup")) {
    int code=keyForCode(e.getKeyCode());
    this.pressedKeys.remove(code);
    if (processor != null)     processor.keyUp(code);
  }
}
