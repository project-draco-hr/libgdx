{
  parentAlpha*=getColor().a;
  SnapshotArray<Actor> children=this.children;
  Actor[] actors=children.begin();
  Rectangle cullingArea=this.cullingArea;
  if (cullingArea != null) {
    float cullLeft=cullingArea.x;
    float cullRight=cullLeft + cullingArea.width;
    float cullBottom=cullingArea.y;
    float cullTop=cullBottom + cullingArea.height;
    if (transform) {
      for (int i=0, n=children.size; i < n; i++) {
        Actor child=actors[i];
        if (!child.isVisible())         continue;
        float x=child.getX(), y=child.getY();
        if (x <= cullRight && y <= cullTop && x + child.getWidth() >= cullLeft && y + child.getHeight() >= cullBottom)         child.draw(batch,parentAlpha);
      }
      batch.flush();
    }
 else {
      float offsetX=getX(), offsetY=getY();
      setX(0);
      setY(0);
      for (int i=0, n=children.size; i < n; i++) {
        Actor child=actors[i];
        if (!child.isVisible())         continue;
        float x=child.getX(), y=child.getY();
        if (x <= cullRight && y <= cullTop && x + child.getWidth() >= cullLeft && y + child.getHeight() >= cullBottom) {
          child.setX(x + offsetX);
          child.setY(y + offsetY);
          child.draw(batch,parentAlpha);
          child.setX(x);
          child.setY(y);
        }
      }
      setX(offsetX);
      setY(offsetY);
    }
  }
 else {
    if (transform) {
      for (int i=0, n=children.size; i < n; i++) {
        Actor child=actors[i];
        if (!child.isVisible())         continue;
        child.draw(batch,parentAlpha);
      }
      batch.flush();
    }
 else {
      float offsetX=getX(), offsetY=getY();
      setX(0);
      setY(0);
      for (int i=0, n=children.size; i < n; i++) {
        Actor child=actors[i];
        if (!child.isVisible())         continue;
        float x=child.getX(), y=child.getY();
        child.setX(x + offsetX);
        child.setY(y + offsetY);
        child.draw(batch,parentAlpha);
        child.setX(x);
        child.setY(y);
      }
      setX(offsetX);
      setY(offsetY);
    }
  }
  children.end();
}
