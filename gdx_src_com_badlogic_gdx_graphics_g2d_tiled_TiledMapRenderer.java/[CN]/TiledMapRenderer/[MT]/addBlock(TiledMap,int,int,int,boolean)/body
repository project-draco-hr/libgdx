{
  int tile;
  AtlasRegion region;
  cache.beginCache();
  TiledLayer layer=map.layers.get(layerNum);
  int firstCol=blockCol * tilesPerBlockX;
  int firstRow=blockRow * tilesPerBlockY;
  int lastCol=Math.min(firstCol + tilesPerBlockX,map.width);
  int lastRow=Math.min(firstRow + tilesPerBlockY,map.height);
  int row, col;
  for (row=firstRow; row < lastRow; row++) {
    for (col=firstCol; col < lastCol; col++) {
      tile=layer.tile[row][col];
      if (tile != 0) {
        if (blended == blendedTiles.contains(tile)) {
          region=atlas.getRegion(tile);
          cache.add(region,col * map.tileWidth + region.offsetX,(map.height - row) * map.tileHeight - region.packedHeight - region.offsetY);
        }
      }
    }
  }
  return cache.endCache();
}
