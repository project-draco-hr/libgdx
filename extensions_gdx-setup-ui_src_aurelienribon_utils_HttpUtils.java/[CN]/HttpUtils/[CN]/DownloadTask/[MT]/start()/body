{
  new Thread(new Runnable(){
    @Override public void run(){
      OutputStream os=null;
      InputStream is=null;
      IOException ex=null;
      if (tag.equals("Test"))       System.out.println("");
      try {
        HttpURLConnection connection=(HttpURLConnection)input.openConnection();
        if (referer != null)         connection.addRequestProperty("REFERER",referer);
        connection.setDoInput(true);
        connection.setDoOutput(false);
        connection.setUseCaches(true);
        connection.setConnectTimeout(3000);
        connection.connect();
        is=new BufferedInputStream(connection.getInputStream(),4096);
        os=output;
        byte[] data=new byte[4096];
        int length=connection.getContentLength();
        int total=0;
        int count;
        while (run && (count=is.read(data)) != -1) {
          total+=count;
          os.write(data,0,count);
          for (          DownloadListener l : listeners)           l.onUpdate(total,length);
        }
      }
 catch (      IOException ex1) {
        ex=ex1;
      }
 finally {
        if (os != null)         try {
          os.flush();
          os.close();
        }
 catch (        IOException ex1) {
        }
        if (is != null)         try {
          is.close();
        }
 catch (        IOException ex1) {
        }
        if (ex != null)         for (        DownloadListener l : listeners)         l.onError(ex);
 else         if (run == true)         for (        DownloadListener l : listeners)         l.onComplete();
 else         for (        DownloadListener l : listeners)         l.onCancel();
        run=false;
      }
    }
  }
).start();
}
