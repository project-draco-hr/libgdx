{
  float x1=p1.x, y1=p1.y, x2=p2.x, y2=p2.y, x3=p3.x, y3=p3.y, x4=p4.x, y4=p4.y;
  float d=(y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);
  if (d == 0)   return false;
  float yd=y1 - y3;
  float xd=x1 - x3;
  float ua=((x4 - x3) * yd - (y4 - y3) * xd) / d;
  if (ua < 0 || ua > 1)   return false;
  float ub=((x2 - x1) * yd - (y2 - y1) * xd) / d;
  if (ub < 0 || ub > 1)   return false;
  if (intersection != null)   intersection.set(x1 + (x2 - x1) * ua,y1 + (y2 - y1) * ua);
  return true;
}
