{
  final GL11 gl=Gdx.gl11;
  gl.glViewport(0,0,Gdx.graphics.getWidth(),Gdx.graphics.getHeight());
  gl.glClear(GL10.GL_COLOR_BUFFER_BIT | GL10.GL_DEPTH_BUFFER_BIT);
  gl.glEnable(GL10.GL_DEPTH_TEST);
  gl.glEnable(GL10.GL_LIGHTING);
  gl.glEnable(GL10.GL_COLOR_MATERIAL);
  gl.glEnable(GL10.GL_TEXTURE_2D);
  gl.glEnable(GL10.GL_LIGHT0);
  gl.glLightfv(GL10.GL_LIGHT0,GL10.GL_DIFFUSE,lightColor,0);
  gl.glLightfv(GL10.GL_LIGHT0,GL10.GL_POSITION,lightPosition,0);
  camera.apply(gl);
  currentMaterial=null;
  gl.glDisable(GL10.GL_TEXTURE_2D);
  for (int i=0; i < textureCount; i++) {
    textureWeights[i]=0;
    textures[i]=null;
  }
  for (int i=0; i < instances.size; i++) {
    final RenderInstance instance=instances.get(i);
    setMaterial(gl,instance.material);
    if (currentMesh != null)     currentMesh.unbind();
    currentMesh=instance.mesh;
    VertexAttribute a=currentMesh.getVertexAttribute(Usage.TextureCoordinates);
    if (a != null)     a.alias=ShaderProgram.TEXCOORD_ATTRIBUTE + currentTexture;
    currentMesh.bind();
    gl.glPushMatrix();
    gl.glMultMatrixf(instance.transform.val,0);
    instance.mesh.render(instance.primitiveType);
    gl.glPopMatrix();
  }
  if (currentMesh != null) {
    currentMesh.unbind();
    currentMesh=null;
  }
}
