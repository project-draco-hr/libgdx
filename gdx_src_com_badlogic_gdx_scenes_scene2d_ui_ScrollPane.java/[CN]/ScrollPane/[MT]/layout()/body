{
  final Drawable bg=style.background;
  final Drawable hScrollKnob=style.hScrollKnob;
  final Drawable vScrollKnob=style.vScrollKnob;
  float bgLeftWidth=0, bgRightWidth=0, bgTopHeight=0, bgBottomHeight=0;
  if (bg != null) {
    bgLeftWidth=bg.getLeftWidth();
    bgRightWidth=bg.getRightWidth();
    bgTopHeight=bg.getTopHeight();
    bgBottomHeight=bg.getBottomHeight();
  }
  float width=getWidth();
  float height=getHeight();
  float scrollbarHeight=0;
  if (hScrollKnob != null)   scrollbarHeight=hScrollKnob.getMinHeight();
  if (style.hScroll != null)   scrollbarHeight=Math.max(scrollbarHeight,style.hScroll.getMinHeight());
  float scrollbarWidth=0;
  if (vScrollKnob != null)   scrollbarWidth=vScrollKnob.getMinWidth();
  if (style.vScroll != null)   scrollbarWidth=Math.max(scrollbarWidth,style.vScroll.getMinWidth());
  areaWidth=width - bgLeftWidth - bgRightWidth;
  areaHeight=height - bgTopHeight - bgBottomHeight;
  if (widget == null)   return;
  float widgetWidth, widgetHeight;
  if (widget instanceof Layout) {
    Layout layout=(Layout)widget;
    widgetWidth=layout.getPrefWidth();
    widgetHeight=layout.getPrefHeight();
  }
 else {
    widgetWidth=widget.getWidth();
    widgetHeight=widget.getHeight();
  }
  scrollX=forceScrollX || (widgetWidth > areaWidth && !disableX);
  scrollY=forceScrollY || (widgetHeight > areaHeight && !disableY);
  boolean fade=fadeScrollBars;
  if (!fade) {
    if (scrollY) {
      areaWidth-=scrollbarWidth;
      if (!scrollX && widgetWidth > areaWidth && !disableX) {
        scrollX=true;
      }
    }
    if (scrollX) {
      areaHeight-=scrollbarHeight;
      if (!scrollY && widgetHeight > areaHeight && !disableY) {
        scrollY=true;
        areaWidth-=scrollbarWidth;
      }
    }
  }
  widgetAreaBounds.set(bgLeftWidth,bgBottomHeight,areaWidth,areaHeight);
  if (fade) {
    if (scrollX)     areaHeight-=scrollbarHeight;
    if (scrollY)     areaWidth-=scrollbarWidth;
  }
 else {
    if (scrollbarsOnTop) {
      if (scrollX)       widgetAreaBounds.height+=scrollbarHeight;
      if (scrollY)       widgetAreaBounds.width+=scrollbarWidth;
    }
 else {
      if (scrollX) {
        if (hScrollOnBottom) {
          widgetAreaBounds.y+=scrollbarHeight;
        }
 else {
          widgetAreaBounds.y=0;
        }
      }
      if (scrollY) {
        if (vScrollOnRight) {
          widgetAreaBounds.x=0;
        }
 else {
          widgetAreaBounds.x+=scrollbarWidth;
        }
      }
    }
  }
  widgetWidth=disableX ? width : Math.max(areaWidth,widgetWidth);
  widgetHeight=disableY ? height : Math.max(areaHeight,widgetHeight);
  maxX=widgetWidth - areaWidth;
  maxY=widgetHeight - areaHeight;
  if (fade) {
    if (scrollX)     maxY-=scrollbarHeight;
    if (scrollY)     maxX-=scrollbarWidth;
  }
  scrollX(MathUtils.clamp(amountX,0,maxX));
  scrollY(MathUtils.clamp(amountY,0,maxY));
  if (scrollX) {
    if (hScrollKnob != null) {
      float hScrollHeight=style.hScroll != null ? style.hScroll.getMinHeight() : hScrollKnob.getMinHeight();
      float boundsX, boundsY;
      if (vScrollOnRight) {
        boundsX=bgLeftWidth;
      }
 else {
        boundsX=bgLeftWidth + scrollbarWidth;
      }
      if (hScrollOnBottom) {
        boundsY=bgBottomHeight;
      }
 else {
        boundsY=height - bgTopHeight - hScrollHeight;
      }
      hScrollBounds.set(boundsX,boundsY,areaWidth,hScrollHeight);
      hKnobBounds.width=Math.max(hScrollKnob.getMinWidth(),(int)(hScrollBounds.width * areaWidth / widgetWidth));
      hKnobBounds.height=hScrollKnob.getMinHeight();
      hKnobBounds.x=hScrollBounds.x + (int)((hScrollBounds.width - hKnobBounds.width) * getScrollPercentX());
      hKnobBounds.y=hScrollBounds.y;
    }
 else {
      hScrollBounds.set(0,0,0,0);
      hKnobBounds.set(0,0,0,0);
    }
  }
  if (scrollY) {
    if (vScrollKnob != null) {
      float vScrollWidth=style.vScroll != null ? style.vScroll.getMinWidth() : vScrollKnob.getMinWidth();
      float boundsX, boundsY;
      if (hScrollOnBottom) {
        boundsY=height - bgTopHeight - areaHeight;
      }
 else {
        boundsY=bgBottomHeight;
      }
      if (vScrollOnRight) {
        boundsX=width - bgRightWidth - vScrollWidth;
      }
 else {
        boundsX=bgLeftWidth;
      }
      vScrollBounds.set(boundsX,boundsY,vScrollWidth,areaHeight);
      vKnobBounds.width=vScrollKnob.getMinWidth();
      vKnobBounds.height=Math.max(vScrollKnob.getMinHeight(),(int)(vScrollBounds.height * areaHeight / widgetHeight));
      if (vScrollOnRight) {
        vKnobBounds.x=width - bgRightWidth - vScrollKnob.getMinWidth();
      }
 else {
        vKnobBounds.x=0;
      }
      vKnobBounds.y=vScrollBounds.y + (int)((vScrollBounds.height - vKnobBounds.height) * (1 - getScrollPercentY()));
    }
 else {
      vScrollBounds.set(0,0,0,0);
      vKnobBounds.set(0,0,0,0);
    }
  }
  if (widget.getWidth() != widgetWidth || widget.getHeight() != widgetHeight) {
    widget.setWidth(widgetWidth);
    widget.setHeight(widgetHeight);
    if (widget instanceof Layout) {
      Layout layout=(Layout)widget;
      layout.invalidate();
      layout.validate();
    }
  }
 else {
    if (widget instanceof Layout)     ((Layout)widget).validate();
  }
}
