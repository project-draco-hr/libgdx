{
  final NinePatch bg=style.background;
  final NinePatch hScrollKnob=style.hScrollKnob;
  final NinePatch vScrollKnob=style.vScrollKnob;
  float areaWidth=width - bg.getLeftWidth() - bg.getRightWidth();
  float areaHeight=height - bg.getTopHeight() - bg.getBottomHeight();
  float widgetWidth, widgetHeight;
  if (widget instanceof Layout) {
    Layout layout=(Layout)widget;
    widgetWidth=layout.getPrefWidth();
    widgetHeight=layout.getPrefHeight();
  }
 else {
    widgetWidth=widget.width;
    widgetHeight=widget.height;
  }
  scrollX=false;
  scrollY=false;
  if (!disableX && widgetWidth > areaWidth)   scrollX=true;
  if (!disableY && widgetHeight > areaHeight)   scrollY=true;
  if (!disableX && scrollY && widgetWidth > areaWidth - vScrollKnob.getTotalWidth()) {
    scrollX=true;
    areaWidth-=vScrollKnob.getTotalWidth();
  }
  if (!disableY && scrollX && widgetHeight > areaHeight - hScrollKnob.getTotalHeight()) {
    scrollY=true;
    areaHeight-=hScrollKnob.getTotalHeight();
  }
  widgetAreaBounds.set(bg.getLeftWidth(),bg.getBottomHeight() + (scrollX ? hScrollKnob.getTotalHeight() : 0),areaWidth,areaHeight);
  amountX=MathUtils.clamp(amountX,0,widgetAreaBounds.x);
  amountY=MathUtils.clamp(amountY,0,widgetAreaBounds.y);
  widgetWidth=disableX ? width : Math.max(areaWidth,widgetWidth);
  widgetHeight=disableY ? height : Math.max(areaHeight,widgetHeight);
  if (widget.width != widgetWidth || widget.height != widgetHeight) {
    widget.width=widgetWidth;
    widget.height=widgetHeight;
    if (widget instanceof Layout)     ((Layout)widget).invalidate();
  }
  if (scrollX) {
    hScrollBounds.set(bg.getLeftWidth(),bg.getBottomHeight(),areaWidth,hScrollKnob.getTotalHeight());
    hKnobBounds.width=Math.max(hScrollKnob.getTotalWidth(),(int)(hScrollBounds.width * areaWidth / widget.width));
    hKnobBounds.height=hScrollKnob.getTotalHeight();
    hKnobBounds.x=hScrollBounds.x + (int)((hScrollBounds.width - hKnobBounds.width) * getScrollPercentX());
    hKnobBounds.y=hScrollBounds.y;
  }
  if (scrollY) {
    vScrollBounds.set(width - bg.getRightWidth() - vScrollKnob.getTotalWidth(),height - bg.getTopHeight() - areaHeight,vScrollKnob.getTotalWidth(),areaHeight);
    vKnobBounds.width=vScrollKnob.getTotalWidth();
    vKnobBounds.height=Math.max(vScrollKnob.getTotalHeight(),(int)(vScrollBounds.height * areaHeight / widget.height));
    vKnobBounds.x=vScrollBounds.x;
    vKnobBounds.y=vScrollBounds.y + (int)((vScrollBounds.height - vKnobBounds.height) * (1 - getScrollPercentY()));
  }
  widget.y=widgetAreaBounds.y - (!scrollY ? (int)(widget.height - areaHeight) : 0) - (scrollY ? (int)((widget.height - areaHeight) * (1 - getScrollPercentY())) : 0);
  widget.x=widgetAreaBounds.x - (scrollX ? (int)((widget.width - areaWidth) * getScrollPercentX()) : 0);
  ScissorStack.calculateScissors(stage.getCamera(),batchTransform,widgetAreaBounds,scissorBounds);
  if (widget instanceof Cullable) {
    widgetCullingArea.x=-widget.x + widgetAreaBounds.x;
    widgetCullingArea.y=-widget.y + widgetAreaBounds.y;
    widgetCullingArea.width=areaWidth;
    widgetCullingArea.height=areaHeight;
    ((Cullable)widget).setCullingArea(widgetCullingArea);
  }
}
