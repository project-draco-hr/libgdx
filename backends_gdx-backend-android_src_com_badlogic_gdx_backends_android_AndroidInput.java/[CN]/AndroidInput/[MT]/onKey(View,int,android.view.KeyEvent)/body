{
  for (int i=0, n=keyListeners.size(); i < n; i++)   if (keyListeners.get(i).onKey(v,keyCode,e))   return true;
synchronized (this) {
    KeyEvent event=null;
    if (e.getKeyCode() == android.view.KeyEvent.KEYCODE_UNKNOWN && e.getAction() == android.view.KeyEvent.ACTION_MULTIPLE) {
      String chars=e.getCharacters();
      for (int i=0; i < chars.length(); i++) {
        event=usedKeyEvents.obtain();
        event.timeStamp=System.nanoTime();
        event.keyCode=0;
        event.keyChar=chars.charAt(i);
        event.type=KeyEvent.KEY_TYPED;
        keyEvents.add(event);
      }
      return false;
    }
    char character=(char)e.getUnicodeChar();
    if (keyCode == 67)     character='\b';
switch (e.getAction()) {
case android.view.KeyEvent.ACTION_DOWN:
      event=usedKeyEvents.obtain();
    event.timeStamp=System.nanoTime();
  event.keyChar=0;
event.keyCode=e.getKeyCode();
event.type=KeyEvent.KEY_DOWN;
if (keyCode == android.view.KeyEvent.KEYCODE_BACK && e.isAltPressed()) {
keyCode=Keys.BUTTON_CIRCLE;
event.keyCode=keyCode;
}
keyEvents.add(event);
keys.add(event.keyCode);
break;
case android.view.KeyEvent.ACTION_UP:
long timeStamp=System.nanoTime();
event=usedKeyEvents.obtain();
event.timeStamp=timeStamp;
event.keyChar=0;
event.keyCode=e.getKeyCode();
event.type=KeyEvent.KEY_UP;
if (keyCode == android.view.KeyEvent.KEYCODE_BACK && e.isAltPressed()) {
keyCode=Keys.BUTTON_CIRCLE;
event.keyCode=keyCode;
}
keyEvents.add(event);
event=usedKeyEvents.obtain();
event.timeStamp=timeStamp;
event.keyChar=character;
event.keyCode=0;
event.type=KeyEvent.KEY_TYPED;
keyEvents.add(event);
if (keyCode == Keys.BUTTON_CIRCLE) keys.remove(Keys.BUTTON_CIRCLE);
 else keys.remove(e.getKeyCode());
}
app.getGraphics().requestRendering();
}
if (keyCode == Keys.BUTTON_CIRCLE) return true;
if (catchBack && keyCode == android.view.KeyEvent.KEYCODE_BACK) return true;
if (catchMenu && keyCode == android.view.KeyEvent.KEYCODE_MENU) return true;
return false;
}
