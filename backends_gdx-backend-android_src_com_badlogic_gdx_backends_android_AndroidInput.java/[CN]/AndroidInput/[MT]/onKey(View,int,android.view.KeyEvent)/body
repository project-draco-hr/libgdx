{
synchronized (this) {
    char character=(char)e.getUnicodeChar();
    if (keyCode == 67)     character='\b';
    KeyEvent event=null;
switch (e.getAction()) {
case android.view.KeyEvent.ACTION_DOWN:
      event=usedKeyEvents.obtain();
    event.keyChar=0;
  event.keyCode=e.getKeyCode();
event.type=KeyEvent.KEY_DOWN;
if (keyCode == android.view.KeyEvent.KEYCODE_BACK && e.isAltPressed()) {
keyCode=Keys.BUTTON_CIRCLE;
event.keyCode=keyCode;
}
keyEvents.add(event);
keys.put(event.keyCode,null);
break;
case android.view.KeyEvent.ACTION_UP:
event=usedKeyEvents.obtain();
event.keyChar=0;
event.keyCode=e.getKeyCode();
event.type=KeyEvent.KEY_UP;
if (keyCode == android.view.KeyEvent.KEYCODE_BACK && e.isAltPressed()) {
keyCode=Keys.BUTTON_CIRCLE;
event.keyCode=keyCode;
}
keyEvents.add(event);
event=usedKeyEvents.obtain();
event.keyChar=character;
event.keyCode=0;
event.type=KeyEvent.KEY_TYPED;
keyEvents.add(event);
if (keyCode == Keys.BUTTON_CIRCLE) keys.remove(Keys.BUTTON_CIRCLE);
 else keys.remove(e.getKeyCode());
}
app.getGraphics().requestRendering();
}
if (keyCode == Keys.BUTTON_CIRCLE) return true;
if (catchBack && keyCode == android.view.KeyEvent.KEYCODE_BACK) return true;
if (catchMenu && keyCode == android.view.KeyEvent.KEYCODE_MENU) return true;
return false;
}
