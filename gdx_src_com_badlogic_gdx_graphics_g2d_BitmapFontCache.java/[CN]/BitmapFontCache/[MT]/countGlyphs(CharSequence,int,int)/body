{
  int count=end - start;
  if (font.markupEnabled) {
    while (start < end) {
      char ch=seq.charAt(start++);
      if (ch == '[') {
        if (start < end && seq.charAt(start) == '[') {
          start++;
          count--;
        }
 else {
          int colorTagLen=markup.parseColorTag(seq,-1,start,end);
          if (colorTagLen >= 0) {
            start+=colorTagLen + 1;
            count-=colorTagLen + 2;
          }
        }
      }
    }
  }
  return count;
}
