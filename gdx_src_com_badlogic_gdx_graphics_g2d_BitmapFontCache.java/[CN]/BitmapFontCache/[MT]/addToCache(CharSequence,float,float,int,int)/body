{
  float startX=x;
  BitmapFont font=this.font;
  Glyph lastGlyph=null;
  if (font.data.scaleX == 1 && font.data.scaleY == 1) {
    while (start < end) {
      lastGlyph=font.data.getGlyph(str.charAt(start++));
      if (lastGlyph != null) {
        addGlyph(lastGlyph,x + lastGlyph.xoffset,y + lastGlyph.yoffset,lastGlyph.width,lastGlyph.height);
        x+=lastGlyph.xadvance;
        break;
      }
    }
    while (start < end) {
      char ch=str.charAt(start++);
      Glyph g=font.data.getGlyph(ch);
      if (g != null) {
        x+=lastGlyph.getKerning(ch);
        lastGlyph=g;
        addGlyph(lastGlyph,x + g.xoffset,y + g.yoffset,g.width,g.height);
        x+=g.xadvance;
      }
    }
  }
 else {
    float scaleX=font.data.scaleX, scaleY=font.data.scaleY;
    while (start < end) {
      lastGlyph=font.data.getGlyph(str.charAt(start++));
      if (lastGlyph != null) {
        addGlyph(lastGlyph,x + lastGlyph.xoffset * scaleX,y + lastGlyph.yoffset * scaleY,lastGlyph.width * scaleX,lastGlyph.height * scaleY);
        x+=lastGlyph.xadvance * scaleX;
        break;
      }
    }
    while (start < end) {
      char ch=str.charAt(start++);
      Glyph g=font.data.getGlyph(ch);
      if (g != null) {
        x+=lastGlyph.getKerning(ch) * scaleX;
        lastGlyph=g;
        addGlyph(lastGlyph,x + g.xoffset * scaleX,y + g.yoffset * scaleY,g.width * scaleX,g.height * scaleY);
        x+=g.xadvance * scaleX;
      }
    }
  }
  return x - startX;
}
