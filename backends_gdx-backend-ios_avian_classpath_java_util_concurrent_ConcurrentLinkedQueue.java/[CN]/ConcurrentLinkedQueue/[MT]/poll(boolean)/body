{
  while (true) {
    Node<T> h=head;
    Node<T> t=tail;
    Node<T> next=head.next;
    if (h == head) {
      if (h == t) {
        if (next != null) {
          Atomic.compareAndSwapObject(this,QueueTail,t,next);
        }
 else {
          return null;
        }
      }
 else {
        T value=next.value;
        if ((!remove) || Atomic.compareAndSwapObject(this,QueueHead,h,next)) {
          return value;
        }
      }
    }
  }
}
