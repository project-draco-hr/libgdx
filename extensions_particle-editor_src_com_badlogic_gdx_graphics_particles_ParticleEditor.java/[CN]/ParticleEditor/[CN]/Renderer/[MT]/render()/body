{
  int viewWidth=Gdx.graphics.getWidth();
  int viewHeight=Gdx.graphics.getHeight();
  float delta=Gdx.graphics.getDeltaTime();
  Gdx.gl.glClear(GL10.GL_COLOR_BUFFER_BIT);
  spriteBatch.begin();
  spriteBatch.enableBlending();
  spriteBatch.setBlendFunction(GL10.GL_SRC_ALPHA,GL10.GL_ONE_MINUS_SRC_ALPHA);
  if (bgImage != null) {
    bgImage.setPosition(viewWidth / 2 - bgImage.getWidth() / 2,viewHeight / 2 - bgImage.getHeight() / 2);
    bgImage.draw(spriteBatch);
  }
  activeCount=0;
  for (  ParticleEmitter emitter : effect.getEmitters()) {
    if (emitter.getTexture() == null && emitter.getImagePath() != null)     loadImage(emitter);
    boolean enabled=isEnabled(emitter);
    if (enabled) {
      if (emitter.getTexture() != null)       emitter.draw(spriteBatch,delta);
      activeCount+=emitter.getActiveCount();
    }
  }
  if (effect.isComplete())   effect.start();
  maxActive=Math.max(maxActive,activeCount);
  maxActiveTimer+=delta;
  if (maxActiveTimer > 3) {
    maxActiveTimer=0;
    lastMaxActive=maxActive;
    maxActive=0;
  }
  if (mouseDown) {
  }
  font.draw(spriteBatch,"FPS: " + Gdx.graphics.getFramesPerSecond(),10,10,Color.WHITE);
  font.draw(spriteBatch,"Count: " + activeCount,10,30,Color.WHITE);
  font.draw(spriteBatch,"Max: " + lastMaxActive,10,50,Color.WHITE);
  font.draw(spriteBatch,(int)(getEmitter().getPercentComplete() * 100) + "%",10,70,Color.WHITE);
  spriteBatch.end();
  Gdx.input.processEvents(this);
}
