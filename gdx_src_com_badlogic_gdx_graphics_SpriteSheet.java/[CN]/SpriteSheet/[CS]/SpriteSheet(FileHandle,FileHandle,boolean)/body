{
  PriorityQueue<PackedSprite> sortedSprites=new PriorityQueue(16,indexComparator);
  BufferedReader reader=new BufferedReader(new InputStreamReader(packFile.read()),64);
  try {
    Sprite pageImage=null;
    while (true) {
      String line=reader.readLine();
      if (line == null)       break;
      if (line.trim().length() == 0)       pageImage=null;
 else       if (pageImage == null) {
        FileHandle file=imagesDir.child(line);
        Format format=Format.valueOf(readValue(reader));
        readTuple(reader);
        TextureFilter min=TextureFilter.valueOf(tuple[0]);
        TextureFilter max=TextureFilter.valueOf(tuple[1]);
        String direction=readValue(reader);
        TextureWrap repeatX=ClampToEdge;
        TextureWrap repeatY=ClampToEdge;
        if (direction.equals("x"))         repeatX=Repeat;
 else         if (direction.equals("y"))         repeatY=Repeat;
 else         if (direction.equals("xy")) {
          repeatX=Repeat;
          repeatY=Repeat;
        }
        Texture texture=Gdx.graphics.newTexture(file,min,max,repeatX,repeatY);
        textures.add(texture);
        pageImage=new Sprite(texture);
      }
 else {
        boolean rotate=Boolean.valueOf(readValue(reader));
        readTuple(reader);
        int left=Integer.parseInt(tuple[0]);
        int top=Integer.parseInt(tuple[1]);
        readTuple(reader);
        int width=Integer.parseInt(tuple[0]);
        int height=Integer.parseInt(tuple[1]);
        if (flip) {
          if (rotate) {
            left+=height;
            height=-height;
          }
 else {
            top+=height;
            height=-height;
          }
        }
        PackedSprite sprite;
        if (rotate) {
          sprite=new PackedSprite(pageImage,left,top,height,width);
          sprite.rotate90(true);
        }
 else         sprite=new PackedSprite(pageImage,left,top,width,height);
        sprite.name=line;
        readTuple(reader);
        sprite.originalWidth=Integer.parseInt(tuple[0]);
        sprite.originalHeight=Integer.parseInt(tuple[1]);
        readTuple(reader);
        sprite.offsetX=Integer.parseInt(tuple[0]);
        sprite.offsetY=Integer.parseInt(tuple[1]);
        sprite.setPosition(sprite.offsetX,sprite.offsetY);
        sprite.index=Integer.parseInt(readValue(reader));
        if (sprite.index == -1)         sprite.index=Integer.MAX_VALUE;
        sortedSprites.add(sprite);
      }
    }
  }
 catch (  IOException ex) {
    throw new GdxRuntimeException("Error reading pack file: " + packFile);
  }
 finally {
    try {
      reader.close();
    }
 catch (    IOException ignored) {
    }
  }
  int n=sortedSprites.size();
  images=new PackedSprite[n];
  for (int i=0; i < n; i++)   images[i]=sortedSprites.poll();
}
