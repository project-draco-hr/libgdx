{
  if (vindex >= Short.MAX_VALUE)   throw new GdxRuntimeException("Too many vertices used");
  if (col == null && colorSet)   col=color;
  if (pos != null) {
    if (vertexTransformationEnabled) {
      tempVTransformed.set(pos).mul(positionTransform);
      vertex[posOffset]=tempVTransformed.x;
      if (posSize > 1)       vertex[posOffset + 1]=tempVTransformed.y;
      if (posSize > 2)       vertex[posOffset + 2]=tempVTransformed.z;
    }
 else {
      vertex[posOffset]=pos.x;
      if (posSize > 1)       vertex[posOffset + 1]=pos.y;
      if (posSize > 2)       vertex[posOffset + 2]=pos.z;
    }
  }
  if (nor != null && norOffset >= 0) {
    if (vertexTransformationEnabled) {
      tempVTransformed.set(nor).mul(normalTransform).nor();
      vertex[norOffset]=tempVTransformed.x;
      vertex[norOffset + 1]=tempVTransformed.y;
      vertex[norOffset + 2]=tempVTransformed.z;
    }
 else {
      vertex[norOffset]=nor.x;
      vertex[norOffset + 1]=nor.y;
      vertex[norOffset + 2]=nor.z;
    }
  }
  if (col != null) {
    if (colOffset >= 0) {
      vertex[colOffset]=col.r;
      vertex[colOffset + 1]=col.g;
      vertex[colOffset + 2]=col.b;
      if (colSize > 3)       vertex[colOffset + 3]=col.a;
    }
 else     if (cpOffset > 0)     vertex[cpOffset]=col.toFloatBits();
  }
  if (uv != null && uvOffset >= 0) {
    vertex[uvOffset]=uv.x;
    vertex[uvOffset + 1]=uv.y;
  }
  vertices.addAll(vertex);
  return (short)(vindex++);
}
