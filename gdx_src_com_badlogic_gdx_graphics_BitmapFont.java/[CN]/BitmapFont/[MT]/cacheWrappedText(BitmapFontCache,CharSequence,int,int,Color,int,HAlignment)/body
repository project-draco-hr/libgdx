{
  final float color=tint.toFloatBits();
  y+=yOffset;
  int length=str.length();
  cache.reset(length);
  int start=0;
  int numLines=0;
  while (start < length) {
    int lineEnd=start + computeVisibleGlpyhs(str,start,indexOf(str,'\n',start),wrapWidth);
    if (lineEnd < length) {
      while (lineEnd > start) {
        char ch=str.charAt(lineEnd);
        if (ch == ' ' || ch == '\n')         break;
        lineEnd--;
      }
    }
    if (lineEnd == start)     lineEnd++;
    int xOffset=0;
    if (alignment != HAlignment.LEFT) {
      int lineWidth=computeTextWidth(str,start,lineEnd);
      xOffset=wrapWidth - lineWidth;
      if (alignment == HAlignment.CENTER)       xOffset/=2;
    }
    addToCache(cache,str,x + xOffset,y,color,start,lineEnd);
    start=lineEnd + 1;
    y+=lineHeight * down;
    numLines++;
  }
  cache.width=wrapWidth;
  cache.height=start - y;
}
