{
  int index=start;
  int width=0;
  Glyph lastGlyph=null;
  if (scaleX == 1) {
    for (; index < end; index++) {
      char ch=str.charAt(index);
      Glyph g=getGlyph(ch);
      if (g != null) {
        if (lastGlyph != null)         width+=lastGlyph.getKerning(ch);
        lastGlyph=g;
        if (width + g.width + g.xoffset > availableWidth)         break;
        width+=g.xadvance;
      }
    }
  }
 else {
    float scaleX=this.scaleX;
    for (; index < end; index++) {
      char ch=str.charAt(index);
      Glyph g=getGlyph(ch);
      if (g != null) {
        if (lastGlyph != null)         width+=lastGlyph.getKerning(ch) * scaleX;
        lastGlyph=g;
        if (width + (g.width + g.xoffset) * scaleX > availableWidth)         break;
        width+=g.xadvance * scaleX;
      }
    }
  }
  return index - start;
}
