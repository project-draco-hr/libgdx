{
  int allCount=Thread.activeCount();
  Thread[] all=new Thread[allCount];
  allCount=Thread.enumerate(all);
  int count=0;
  for (int i=0; i < allCount && count < threads.length; ++i) {
    Thread t=all[i];
    ThreadGroup g=t.getThreadGroup();
    if (g == this || (recurse && parentOf(g))) {
      threads[count++]=t;
    }
  }
  return count;
}
