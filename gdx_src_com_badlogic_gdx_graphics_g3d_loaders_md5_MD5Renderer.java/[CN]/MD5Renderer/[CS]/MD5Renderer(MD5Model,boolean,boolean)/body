{
  if (useJni && useNormals)   throw new GdxRuntimeException("JNI with normals is currently unsupported.");
  int maxVertices=0;
  int maxIndices=0;
  int stride=useNormals ? 8 : 5;
  this.model=model;
  this.useJni=useJni;
  this.useNormals=useNormals;
  this.indices=new short[model.meshes.length][];
  this.vertices=new float[model.meshes.length][];
  for (int i=0; i < model.meshes.length; i++) {
    if (maxVertices < model.meshes[i].numVertices)     maxVertices=model.meshes[i].numVertices;
    if (maxIndices < model.meshes[i].numTriangles * 3)     maxIndices=model.meshes[i].numTriangles * 3;
    this.indices[i]=model.meshes[i].getIndices();
    this.vertices[i]=model.meshes[i].createVertexArray(stride);
  }
  if (useNormals) {
    this.mesh=new Mesh(false,maxVertices,maxIndices,new VertexAttribute(VertexAttributes.Usage.Position,3,"a_position"),new VertexAttribute(VertexAttributes.Usage.TextureCoordinates,2,"a_texCoords"),new VertexAttribute(VertexAttributes.Usage.Normal,3,"a_normal"));
  }
 else {
    this.mesh=new Mesh(false,maxVertices,maxIndices,new VertexAttribute(VertexAttributes.Usage.Position,3,"a_position"),new VertexAttribute(VertexAttributes.Usage.TextureCoordinates,2,"a_texCoords"));
  }
}
