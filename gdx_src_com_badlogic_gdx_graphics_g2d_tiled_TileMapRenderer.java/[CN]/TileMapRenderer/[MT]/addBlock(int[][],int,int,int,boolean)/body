{
  int tile;
  AtlasRegion region;
  cache.beginCache();
  int firstCol=blockCol * tilesPerBlockX;
  int firstRow=blockRow * tilesPerBlockY;
  int lastCol=firstCol + tilesPerBlockX;
  int lastRow=firstRow + tilesPerBlockY;
  int row, col;
  float x, y;
  for (row=firstRow; row < lastRow && row < layer.length; row++) {
    for (col=firstCol; col < lastCol && col < layer[row].length; col++) {
      tile=layer[row][col];
      if (tile != 0) {
        if (blended == blendedTiles.contains(tile)) {
          region=atlas.getRegion(tile);
          if (region != null) {
            y=((layer.length - row) - (region.packedHeight + region.offsetY) / tileHeight) * unitsPerTileY;
            x=(col + region.offsetX / tileWidth) * unitsPerTileX;
            cache.add(region,x,y,unitsPerTileX,unitsPerTileY);
          }
        }
      }
    }
  }
  return cache.endCache();
}
