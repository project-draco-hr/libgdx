{
  try {
    int readBytes=0;
    while (true) {
      int length=in.read(out,readBytes,out.length - readBytes);
      if (length == -1)       break;
      if (length == 0)       throw new RuntimeException("Buffer to small for downloading content");
      readBytes+=length;
      if (progress != null)       progress.setProgress(readBytes / (float)contentLength);
      if (Thread.currentThread().isInterrupted())       throw new InterruptedException();
    }
    if (progress != null)     progress.setProgress(1);
    return readBytes;
  }
 catch (  Exception ex) {
    if (progress != null)     progress.setProgress(0);
    return 0;
  }
 finally {
    try {
      if (in != null)       in.close();
    }
 catch (    Exception ignored) {
    }
  }
}
