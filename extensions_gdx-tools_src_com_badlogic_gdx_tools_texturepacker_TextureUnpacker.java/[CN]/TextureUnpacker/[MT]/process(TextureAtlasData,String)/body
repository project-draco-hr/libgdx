{
  for (  Region region : atlasData.getRegions()) {
    BufferedImage src=ImageIO.read(region.page.textureFile.read());
    BufferedImage subimage=null;
    System.out.println(String.format("processing image for %s x[%s] y[%s] w[%s] h[%s], rotate[%s]",region.name,region.left,region.top,region.width,region.height,region.rotate));
    if (region.rotate) {
      BufferedImage unRotatedImage=src.getSubimage(region.left,region.top,region.height,region.width);
      double rotationRequired=Math.toRadians(90.0);
      double locationX=unRotatedImage.getWidth() / 2;
      double locationY=unRotatedImage.getHeight() / 2;
      AffineTransform tx=AffineTransform.getRotateInstance(rotationRequired,locationX,locationY);
      AffineTransformOp op=new AffineTransformOp(tx,AffineTransformOp.TYPE_BILINEAR);
      subimage=op.filter(unRotatedImage,subimage);
    }
 else {
      subimage=src.getSubimage(region.left,region.top,region.width,region.height);
    }
    ImageIO.write(subimage,"PNG",new FileOutputStream(output + File.separator + region.name+ ".png"));
  }
}
