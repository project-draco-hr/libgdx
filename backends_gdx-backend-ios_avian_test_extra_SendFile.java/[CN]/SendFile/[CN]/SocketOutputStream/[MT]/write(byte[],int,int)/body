{
  ByteBuffer buf=ByteBuffer.wrap(buffer);
  buf.position(offset);
  buf.limit(offset + length);
  while (buf.hasRemaining()) {
    selector.select(10000);
    for (    SelectionKey key : selector.selectedKeys()) {
      if (key.isWritable() && (key.channel() == channel)) {
        channel.write(buf);
      }
    }
  }
}
