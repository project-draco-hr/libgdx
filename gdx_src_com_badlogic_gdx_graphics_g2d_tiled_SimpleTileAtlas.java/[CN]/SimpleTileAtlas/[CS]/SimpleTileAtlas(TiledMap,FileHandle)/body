{
  for (  TileSet set : map.tileSets) {
    Pixmap pixmap=new Pixmap(inputDir.child(set.imageName));
    int originalWidth=pixmap.getWidth();
    int originalHeight=pixmap.getHeight();
    if (!MathUtils.isPowerOfTwo(originalWidth) || !MathUtils.isPowerOfTwo(originalHeight)) {
      final int width=MathUtils.nextPowerOfTwo(originalWidth);
      final int height=MathUtils.nextPowerOfTwo(originalHeight);
      Pixmap potPixmap=new Pixmap(width,height,pixmap.getFormat());
      potPixmap.drawPixmap(pixmap,0,0,0,0,width,height);
      pixmap.dispose();
      pixmap=potPixmap;
    }
    Texture texture=new Texture(pixmap);
    pixmap.dispose();
    int idx=0;
    TextureRegion[][] regions=split(texture,originalWidth,originalHeight,map.tileWidth,map.tileHeight,set.spacing,set.margin);
    for (int y=0; y < regions[0].length; y++) {
      for (int x=0; x < regions.length; x++) {
        regionsMap.put(idx++ + set.firstgid,regions[x][y]);
      }
    }
  }
}
