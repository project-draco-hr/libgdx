{
  this.observer=observer;
  this.config=config;
  for (int i=0; i < config.getOfferCount(); i++) {
    Offer offer=config.getOffer(i);
    String identifier=offer.getIdentifier();
    Map<String,String> identifierForStores=offer.getIdentifierForStores();
    for (    Map.Entry<String,String> entry : identifierForStores.entrySet()) {
      String storeNameOpenIAB=storeNameToOpenIAB(entry.getKey());
      String identifierForStore=entry.getValue();
      if (!(SkuManager.getInstance().getStoreSku(storeNameOpenIAB,identifier).equals(identifierForStore))) {
        SkuManager.getInstance().mapSku(identifier,storeNameOpenIAB,identifierForStore);
      }
    }
  }
  Map<String,String> storeKeys=new HashMap<String,String>(16);
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_GOOGLE) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_GOOGLE),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_GOOGLE));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_AMAZON) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_AMAZON),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_AMAZON));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_SAMSUNG) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_SAMSUNG),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_SAMSUNG));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_NOKIA) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_NOKIA),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_NOKIA));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_SLIDEME) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_SLIDEME),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_SLIDEME));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_APTOIDE) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_APTOIDE),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_APTOIDE));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_APPLAND) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_APPLAND),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_APPLAND));
  }
  if (config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_YANDEX) != null) {
    storeKeys.put(storeNameToOpenIAB(PurchaseManagerConfig.STORE_NAME_ANDROID_YANDEX),(String)config.getStoreParam(PurchaseManagerConfig.STORE_NAME_ANDROID_YANDEX));
  }
  OpenIabHelper.Options.Builder builder=new OpenIabHelper.Options.Builder();
  builder.setVerifyMode(OpenIabHelper.Options.VERIFY_SKIP);
  builder.addStoreKeys(storeKeys);
  helper=new OpenIabHelper(activity,builder.build());
  helper.startSetup(new IabHelper.OnIabSetupFinishedListener(){
    public void onIabSetupFinished(    IabResult result){
      if (!result.isSuccess()) {
        helper=null;
        inventory=null;
        PurchaseManagerAndroidOpenIAB.this.observer=null;
        PurchaseManagerAndroidOpenIAB.this.config=null;
        observer.handleInstallError(new RuntimeException("Problem setting up in-app billing: " + result));
      }
 else {
        boolean querySkuDetails=true;
        helper.queryInventoryAsync(querySkuDetails,new IabHelper.QueryInventoryFinishedListener(){
          @Override public void onQueryInventoryFinished(          IabResult result,          Inventory inventory){
            PurchaseManagerAndroidOpenIAB.this.inventory=inventory;
            observer.handleInstall();
          }
        }
);
      }
    }
  }
);
}
