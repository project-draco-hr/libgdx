{
  if (glfwWindowShouldClose(graphics.window)) {
    exit();
    return;
  }
synchronized (runnables) {
    executedRunnables.clear();
    executedRunnables.addAll(runnables);
    runnables.clear();
  }
  if (executedRunnables.size > 0) {
    for (int i=0; i < executedRunnables.size; i++)     executedRunnables.get(i).run();
    if (!running)     return;
    graphics.requestRendering();
  }
  input.update();
  int targetFPS=(graphics.isHidden() || graphics.isMinimized()) ? hiddenFPS : (graphics.isForeground() ? foregroundFPS : backgroundFPS);
  long time=System.nanoTime();
  if (graphics.shouldRender() && targetFPS != -1)   render(time);
  if (targetFPS != 0)   sleep(targetFPS == -1 ? 100 : (int)(1000f / targetFPS - (System.nanoTime() - time) / 1000000f));
}
