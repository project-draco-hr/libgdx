{
  long days=timeInMillis / MILLIS_PER_DAY;
  days+=DAYS_TO_EPOCH;
  long years=4 * days / 1461;
  int year=(int)(EPOCH_LEAP_YEAR + years);
  days-=365 * years + years / 4;
  if (!isLeapYear(year))   days--;
  int month=0;
  int leapIndex=isLeapYear(year) ? 1 : 0;
  while (days >= DAYS_IN_MONTH[leapIndex][month]) {
    days-=DAYS_IN_MONTH[leapIndex][month++];
  }
  days++;
  int remainder=(int)(timeInMillis % MILLIS_PER_DAY);
  int hour=remainder / MILLIS_PER_HOUR;
  remainder=remainder % MILLIS_PER_HOUR;
  int minute=remainder / MILLIS_PER_MINUTE;
  remainder=remainder % MILLIS_PER_MINUTE;
  int second=remainder / MILLIS_PER_SECOND;
  fields[YEAR]=year;
  fields[MONTH]=month;
  fields[DAY_OF_MONTH]=(int)days;
  fields[HOUR_OF_DAY]=hour;
  fields[MINUTE]=minute;
  fields[SECOND]=second;
}
