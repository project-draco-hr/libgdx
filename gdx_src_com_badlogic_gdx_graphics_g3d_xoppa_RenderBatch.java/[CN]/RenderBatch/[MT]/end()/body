{
  instances.sort(listener);
  Shader currentShader=null;
  for (int i=0; i < instances.size; i++) {
    final RenderInstance instance=instances.get(i);
    if (currentShader != instance.shader) {
      if (currentShader != null)       currentShader.end();
      currentShader=instance.shader;
      currentShader.begin(camera);
    }
    currentShader.render(instance);
  }
  if (currentShader != null)   currentShader.end();
  instancePool.freeAll(instances);
  instances.clear();
  camera=null;
}
