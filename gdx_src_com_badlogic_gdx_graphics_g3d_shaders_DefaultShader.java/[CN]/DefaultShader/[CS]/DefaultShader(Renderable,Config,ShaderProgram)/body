{
  final Attributes attributes=combineAttributes(renderable);
  this.config=config;
  this.program=shaderProgram;
  this.lighting=renderable.environment != null;
  this.environmentCubemap=attributes.has(CubemapAttribute.EnvironmentMap) || (lighting && attributes.has(CubemapAttribute.EnvironmentMap));
  this.shadowMap=lighting && renderable.environment.shadowMap != null;
  this.renderable=renderable;
  attributesMask=attributes.getMask() | optionalAttributes;
  vertexMask=renderable.mesh.getVertexAttributes().getMask();
  this.directionalLights=new DirectionalLight[lighting && config.numDirectionalLights > 0 ? config.numDirectionalLights : 0];
  for (int i=0; i < directionalLights.length; i++)   directionalLights[i]=new DirectionalLight();
  this.pointLights=new PointLight[lighting && config.numPointLights > 0 ? config.numPointLights : 0];
  for (int i=0; i < pointLights.length; i++)   pointLights[i]=new PointLight();
  this.spotLights=new SpotLight[lighting && config.numSpotLights > 0 ? config.numSpotLights : 0];
  for (int i=0; i < spotLights.length; i++)   spotLights[i]=new SpotLight();
  if (!config.ignoreUnimplemented && (implementedFlags & attributesMask) != attributesMask)   throw new GdxRuntimeException("Some attributes not implemented yet (" + attributesMask + ")");
  u_projTrans=register(Inputs.projTrans,Setters.projTrans);
  u_viewTrans=register(Inputs.viewTrans,Setters.viewTrans);
  u_projViewTrans=register(Inputs.projViewTrans,Setters.projViewTrans);
  u_cameraPosition=register(Inputs.cameraPosition,Setters.cameraPosition);
  u_cameraDirection=register(Inputs.cameraDirection,Setters.cameraDirection);
  u_cameraUp=register(Inputs.cameraUp,Setters.cameraUp);
  u_time=register(new Uniform("u_time"));
  u_worldTrans=register(Inputs.worldTrans,Setters.worldTrans);
  u_viewWorldTrans=register(Inputs.viewWorldTrans,Setters.viewWorldTrans);
  u_projViewWorldTrans=register(Inputs.projViewWorldTrans,Setters.projViewWorldTrans);
  u_normalMatrix=register(Inputs.normalMatrix,Setters.normalMatrix);
  u_bones=(renderable.bones != null && config.numBones > 0) ? register(Inputs.bones,new Setters.Bones(config.numBones)) : -1;
  u_shininess=register(Inputs.shininess,Setters.shininess);
  u_opacity=register(Inputs.opacity);
  u_diffuseColor=register(Inputs.diffuseColor,Setters.diffuseColor);
  u_diffuseTexture=register(Inputs.diffuseTexture,Setters.diffuseTexture);
  u_diffuseUVTransform=register(Inputs.diffuseUVTransform,Setters.diffuseUVTransform);
  u_specularColor=register(Inputs.specularColor,Setters.specularColor);
  u_specularTexture=register(Inputs.specularTexture,Setters.specularTexture);
  u_specularUVTransform=register(Inputs.specularUVTransform,Setters.specularUVTransform);
  u_emissiveColor=register(Inputs.emissiveColor,Setters.emissiveColor);
  u_emissiveTexture=register(Inputs.emissiveTexture,Setters.emissiveTexture);
  u_emissiveUVTransform=register(Inputs.emissiveUVTransform,Setters.emissiveUVTransform);
  u_reflectionColor=register(Inputs.reflectionColor,Setters.reflectionColor);
  u_reflectionTexture=register(Inputs.reflectionTexture,Setters.reflectionTexture);
  u_reflectionUVTransform=register(Inputs.reflectionUVTransform,Setters.reflectionUVTransform);
  u_normalTexture=register(Inputs.normalTexture,Setters.normalTexture);
  u_normalUVTransform=register(Inputs.normalUVTransform,Setters.normalUVTransform);
  u_ambientTexture=register(Inputs.ambientTexture,Setters.ambientTexture);
  u_ambientUVTransform=register(Inputs.ambientUVTransform,Setters.ambientUVTransform);
  u_alphaTest=register(Inputs.alphaTest);
  u_ambientCubemap=lighting ? register(Inputs.ambientCube,new Setters.ACubemap(config.numDirectionalLights,config.numPointLights)) : -1;
  u_environmentCubemap=environmentCubemap ? register(Inputs.environmentCubemap,Setters.environmentCubemap) : -1;
}
