{
  String package_path="/javax/media/";
  String library="";
  String os=System.getProperty("os.name");
  String arch=System.getProperty("os.arch");
  if (os.contains("Windows")) {
    if (!arch.equals("amd64"))     library=resource + "-win32.dll";
 else {
      library=resource + "-win64.dll";
    }
  }
  if (os.contains("Linux")) {
    if (!arch.equals("amd64"))     library="lib" + resource + "-linux32.so";
 else     library="lib" + resource + "-linux64.so";
  }
  if (os.contains("Mac")) {
    library="lib" + resource + ".jnilib";
  }
  String so=System.getProperty("java.io.tmpdir") + "/" + System.nanoTime()+ library;
  InputStream in=JoglGraphics.class.getResourceAsStream(package_path + library);
  if (in == null)   throw new RuntimeException("couldn't find " + library + " in jar file.");
  try {
    BufferedOutputStream out=new BufferedOutputStream(new FileOutputStream(so));
    byte[] bytes=new byte[1024 * 4];
    while (true) {
      int read_bytes=in.read(bytes);
      if (read_bytes == -1)       break;
      out.write(bytes,0,read_bytes);
    }
    out.close();
    in.close();
    System.load(so);
  }
 catch (  FileNotFoundException e) {
    throw new RuntimeException("couldn't write " + library + " to temporary file "+ so);
  }
catch (  IOException e) {
    throw new RuntimeException("couldn't write " + library + " to temporary file "+ so);
  }
}
