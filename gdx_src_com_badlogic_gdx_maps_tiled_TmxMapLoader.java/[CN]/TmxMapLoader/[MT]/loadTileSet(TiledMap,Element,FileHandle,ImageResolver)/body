{
  if (element.getName().equals("tileset")) {
    String name=element.get("name",null);
    int firstgid=element.getIntAttribute("firstgid",1);
    int tilewidth=element.getIntAttribute("tilewidth",0);
    int tileheight=element.getIntAttribute("tileheight",0);
    int spacing=element.getIntAttribute("spacing",0);
    int margin=element.getIntAttribute("margin",0);
    String source=element.getAttribute("source",null);
    FileHandle image=null;
    if (source != null) {
      FileHandle tsx=getRelativeFileHandle(tmxFile,source);
      try {
        element=xml.parse(tsx);
        name=element.get("name",null);
        tilewidth=element.getIntAttribute("tilewidth",0);
        tileheight=element.getIntAttribute("tileheight",0);
        spacing=element.getIntAttribute("spacing",0);
        margin=element.getIntAttribute("margin",0);
        String imageSource=element.getChildByName("image").getAttribute("source");
        image=getRelativeFileHandle(tsx,imageSource);
      }
 catch (      IOException e) {
        throw new GdxRuntimeException("Error parsing external tileset.");
      }
    }
 else {
      String imageSource=element.getChildByName("image").getAttribute("source");
      image=getRelativeFileHandle(tmxFile,imageSource);
    }
    TextureRegion texture=imageResolver.getImage(image.path());
    TiledMapTileSet tileset=new TiledMapTileSet();
    tileset.setName(name);
    int stopWidth=texture.getRegionWidth() - tilewidth;
    int stopHeight=texture.getRegionHeight() - tileheight;
    int id=firstgid;
    for (int y=margin; y <= stopHeight; y+=tileheight + spacing) {
      for (int x=margin; x <= stopWidth; x+=tilewidth + spacing) {
        TiledMapTile tile=new StaticTiledMapTile(new TextureRegion(texture,x,y,tilewidth,tileheight));
        tileset.putTile(id++,tile);
      }
    }
    Array<Element> tileElements=element.getChildrenByName("tile");
    for (    Element tileElement : tileElements) {
      int localtid=tileElement.getIntAttribute("id",0);
      TiledMapTile tile=tileset.getTile(firstgid + localtid);
      if (tile != null) {
        Element properties=tileElement.getChildByName("properties");
        if (properties != null) {
          loadProperties(tile.getProperties(),properties);
        }
      }
    }
    Element properties=element.getChildByName("properties");
    if (properties != null) {
      loadProperties(tileset.getProperties(),properties);
    }
    map.getTileSets().addTileSet(tileset);
  }
}
