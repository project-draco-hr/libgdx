{
  int read=0;
  int total=0;
  if (buffer.length < samples.length * 2)   buffer=new byte[samples.length * 2];
  numSamples*=2;
  try {
    while ((read=in.read(buffer,total,numSamples - total)) > 0) {
      total+=read;
    }
    total=total - (total % 2);
    for (int j=0; j < total; j+=2) {
      samples[offset++]=(short)(((buffer[j + 1] << 8) & 0xff00) | (buffer[j] & 0xff));
    }
  }
 catch (  IOException e) {
    return 0;
  }
  total=total / 2;
  return total;
}
