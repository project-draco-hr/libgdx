{
  if (shortBuffer == null || shortBuffer.capacity() != samples.length) {
    ByteBuffer byteBuffer=ByteBuffer.allocateDirect(samples.length * Short.SIZE / 8);
    byteBuffer.order(ByteOrder.nativeOrder());
    shortBuffer=byteBuffer.asShortBuffer();
  }
  int readSamples=readSamples(handle,shortBuffer,samples.length);
  if (readSamples == 0) {
    closeFile(handle);
    return 0;
  }
  shortBuffer.position(0);
  shortBuffer.get(samples);
  return samples.length;
}
