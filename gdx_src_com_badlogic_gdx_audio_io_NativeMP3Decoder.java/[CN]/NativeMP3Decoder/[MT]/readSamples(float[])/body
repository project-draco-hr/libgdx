{
  if (buffer == null || buffer.capacity() != samples.length) {
    ByteBuffer byteBuffer=ByteBuffer.allocateDirect(samples.length * Float.SIZE / 8);
    byteBuffer.order(ByteOrder.nativeOrder());
    buffer=byteBuffer.asFloatBuffer();
  }
  int readSamples=readSamples(handle,buffer,samples.length);
  if (readSamples == 0) {
    closeFile(handle);
    return 0;
  }
  buffer.position(0);
  buffer.get(samples);
  return samples.length;
}
