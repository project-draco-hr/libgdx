{
  if (!connected) {
    natThrowWriteError(socket);
  }
  if (b.remaining() == 0)   return 0;
  byte[] array=b.array();
  if (array == null)   throw new NullPointerException();
  int w=natWrite(socket,array,b.arrayOffset() + b.position(),b.remaining(),blocking);
  if (w > 0) {
    b.position(b.position() + w);
  }
  return w;
}
