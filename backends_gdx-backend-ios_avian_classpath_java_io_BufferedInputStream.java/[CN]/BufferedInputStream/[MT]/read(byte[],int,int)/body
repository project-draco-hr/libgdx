{
  int count=0;
  if (position < limit) {
    int remaining=limit - position;
    if (remaining > length) {
      remaining=length;
    }
    System.arraycopy(buffer,position,b,offset,remaining);
    count+=remaining;
    position+=remaining;
    offset+=remaining;
    length-=remaining;
  }
  while (length > 0) {
    int c=in.read(b,offset,length);
    if (c == -1) {
      if (count == 0) {
        count=-1;
      }
      break;
    }
 else {
      offset+=c;
      count+=c;
      length-=c;
      if (in.available() <= 0) {
        break;
      }
    }
  }
  return count;
}
