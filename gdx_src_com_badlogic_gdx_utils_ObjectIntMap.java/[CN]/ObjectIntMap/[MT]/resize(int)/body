{
  int oldEndIndex=capacity + stashSize;
  capacity=newSize;
  threshold=(int)(newSize * loadFactor);
  mask=newSize - 1;
  hashShift=31 - Integer.numberOfTrailingZeros(newSize);
  stashCapacity=Math.max(3,(int)Math.ceil(Math.log(newSize)));
  pushIterations=Math.max(Math.min(capacity,32),(int)Math.sqrt(capacity) / 4);
  K[] oldKeyTable=keyTable;
  int[] oldValueTable=valueTable;
  keyTable=(K[])new Object[newSize + stashCapacity];
  valueTable=new int[newSize + stashCapacity];
  size=0;
  stashSize=0;
  for (int i=0; i < oldEndIndex; i++) {
    K key=oldKeyTable[i];
    if (key != null)     putResize(key,oldValueTable[i]);
  }
}
