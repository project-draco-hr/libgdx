{
  int newMask=newSize - 1;
  mask=newMask;
  capacity=newSize;
  threshold=(int)(newSize * loadFactor);
  newSize+=EXTRA;
  int[] newKeyTable=new int[newSize];
  for (int i=newSize - 1; i >= 0; i--)   newKeyTable[i]=EMPTY;
  V[] newValueTable=(V[])new Object[newSize];
  int[] keyTable=this.keyTable;
  V[] valueTable=this.valueTable;
  for (int i=0, n=keyTable.length; i < n; i++) {
    int key=keyTable[i];
    if (key != EMPTY) {
      int index=key & newMask;
      while (true) {
        if (newKeyTable[index] == EMPTY)         break;
        index++;
      }
      if (index == newSize) {
        resize(capacity << 1);
        return;
      }
      newKeyTable[index]=key;
      newValueTable[index]=valueTable[i];
    }
  }
  this.keyTable=newKeyTable;
  this.valueTable=newValueTable;
}
