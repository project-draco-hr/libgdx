{
  glyphAdvances.clear();
  glyphPositions.clear();
  int index=0;
  int end=str.length();
  float width=0;
  Glyph lastGlyph=null;
  BitmapFontData data=this.data;
  if (data.scaleX == 1) {
    for (; index < end; index++) {
      char ch=str.charAt(index);
      Glyph g=data.getGlyph(ch);
      if (g != null) {
        if (lastGlyph != null)         width+=lastGlyph.getKerning(ch);
        lastGlyph=g;
        glyphAdvances.add(g.xadvance);
        glyphPositions.add(width);
        width+=g.xadvance;
      }
    }
    glyphAdvances.add(0);
    glyphPositions.add(width);
  }
 else {
    float scaleX=this.data.scaleX;
    for (; index < end; index++) {
      char ch=str.charAt(index);
      Glyph g=data.getGlyph(ch);
      if (g != null) {
        if (lastGlyph != null)         width+=lastGlyph.getKerning(ch) * scaleX;
        lastGlyph=g;
        float xadvance=g.xadvance * scaleX;
        glyphAdvances.add(xadvance);
        glyphPositions.add(width);
        width+=xadvance;
      }
    }
    glyphAdvances.add(0);
    glyphPositions.add(width);
  }
}
