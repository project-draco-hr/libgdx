{
  boolean markupEnabled=this.markupEnabled;
  float scaleX=this.scaleX;
  Array<Glyph> glyphs=run.glyphs;
  FloatArray xAdvances=run.xAdvances;
  Glyph lastGlyph=null;
  while (start < end) {
    char ch=str.charAt(start++);
    Glyph glyph=getGlyph(ch);
    if (glyph == null)     continue;
    glyphs.add(glyph);
    if (lastGlyph == null) {
      if (glyph.fixedWidth) {
        xAdvances.add(0);
      }
 else {
        xAdvances.add(-glyph.xoffset * scaleX - padLeft);
      }
    }
 else {
      xAdvances.add((lastGlyph.xadvance + lastGlyph.getKerning(ch)) * scaleX);
    }
    lastGlyph=glyph;
    if (markupEnabled && ch == '[' && start < end && str.charAt(start) == '[')     start++;
  }
  if (lastGlyph != null) {
    if (lastGlyph.fixedWidth) {
      xAdvances.add(lastGlyph.xadvance * scaleX - padRight);
    }
 else {
      xAdvances.add((lastGlyph.xoffset + lastGlyph.width) * scaleX - padRight);
    }
  }
}
