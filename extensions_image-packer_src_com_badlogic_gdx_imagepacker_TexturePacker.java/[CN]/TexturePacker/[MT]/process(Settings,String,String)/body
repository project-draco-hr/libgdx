{
  File inputDir=new File(input);
  File outputDir=new File(output);
  if (!inputDir.isDirectory()) {
    System.out.println("Not a directory: " + inputDir);
    return;
  }
  File packFile=new File(outputDir,"pack");
  File incrmentalFile=null;
  if (settings.incremental && packFile.exists()) {
    settings.crcs.clear();
    incrmentalFile=new File(System.getProperty("user.home") + "/.texturepacker/" + hash(inputDir.getAbsolutePath()));
    if (incrmentalFile.exists()) {
      BufferedReader reader=new BufferedReader(new FileReader(incrmentalFile));
      while (true) {
        String path=reader.readLine();
        if (path == null)         break;
        String crc=reader.readLine();
        if (crc == null)         break;
        settings.crcs.put(path,Long.parseLong(crc));
      }
      reader.close();
    }
    BufferedReader reader=new BufferedReader(new FileReader(packFile));
    StringBuilder buffer=new StringBuilder(2048);
    while (true) {
      String imageName=reader.readLine();
      if (imageName == null)       break;
      if (imageName.length() == 0)       continue;
      String pageName=imageName.replaceAll("\\d+.png$","");
      String section=settings.packSections.get(pageName);
      if (section != null)       buffer.append(section);
      buffer.append('\n');
      buffer.append(imageName);
      buffer.append('\n');
      while (true) {
        String line=reader.readLine();
        if (line == null || line.length() == 0)         break;
        buffer.append(line);
        buffer.append('\n');
      }
      settings.packSections.put(pageName,buffer.toString());
      buffer.setLength(0);
    }
    reader.close();
  }
  packFile.delete();
  process(settings,inputDir,outputDir,packFile);
  if (incrmentalFile != null) {
    incrmentalFile.getParentFile().mkdirs();
    FileWriter writer=new FileWriter(incrmentalFile);
    for (    Entry<String,Long> entry : settings.crcs.entrySet()) {
      writer.write(entry.getKey() + "\n");
      writer.write(entry.getValue() + "\n");
    }
    writer.close();
  }
}
