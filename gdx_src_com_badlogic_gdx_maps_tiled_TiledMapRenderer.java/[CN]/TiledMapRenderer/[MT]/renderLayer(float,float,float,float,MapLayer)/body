{
  if (layer.getVisible()) {
    spriteBatch.setColor(1,1,1,layer.getOpacity());
    if (layer instanceof TiledMapTileLayer) {
      final TiledMapTileLayer tileLayer=(TiledMapTileLayer)layer;
      final int layerWidth=tileLayer.getWidth();
      final int layerHeight=tileLayer.getHeight();
      final float layerTileWidth=tileLayer.getTileWidth() * unitScale;
      final float layerTileHeight=tileLayer.getTileHeight() * unitScale;
      final int x1=Math.max(0,(int)(camLeft / layerTileWidth));
      final int x2=Math.min(layerWidth,(int)((camRight + layerTileWidth) / layerTileWidth));
      final int y1=Math.max(0,(int)(camBottom / layerTileHeight));
      final int y2=Math.min(layerHeight,(int)((camTop + layerTileHeight) / layerTileHeight));
      for (int x=x1; x < x2; x++) {
        for (int y=y1; y < y2; y++) {
          final TiledMapTileLayer.Cell cell=tileLayer.getCell(x,y);
          final TiledMapTile tile=cell.getTile();
          if (tile != null) {
            final boolean flipX=cell.getFlipHorizontally();
            final boolean flipY=cell.getFlipVertically();
            final boolean rotate=cell.getFlipDiagonally();
            TextureRegion region=tile.getTextureRegion();
            float drawX=x * layerTileWidth;
            float drawY=y * layerTileHeight;
            float width=layerTileWidth;
            float height=layerTileHeight;
            float originX=width * 0.5f;
            float originY=height * 0.5f;
            float scaleX=1;
            float scaleY=1;
            float rotation=0;
            int sourceX=region.getRegionX();
            int sourceY=region.getRegionY();
            int sourceWidth=region.getRegionWidth();
            int sourceHeight=region.getRegionHeight();
            if (rotate) {
              if (flipX && flipY) {
                rotation=-90;
                sourceX+=sourceWidth;
                sourceWidth=-sourceWidth;
              }
 else               if (flipX) {
                rotation=-90;
              }
 else               if (flipY) {
                rotation=+90;
              }
 else {
                rotation=-90;
                sourceY+=sourceHeight;
                sourceHeight=-sourceHeight;
              }
            }
 else {
              if (flipX) {
                sourceX+=sourceWidth;
                sourceWidth=-sourceWidth;
              }
              if (flipY) {
                sourceY+=sourceHeight;
                sourceHeight=-sourceHeight;
              }
            }
            spriteBatch.draw(region.getTexture(),drawX,drawY,originX,originY,width,height,scaleX,scaleY,rotation,sourceX,sourceY,sourceWidth,sourceHeight,false,false);
          }
        }
      }
    }
  }
}
