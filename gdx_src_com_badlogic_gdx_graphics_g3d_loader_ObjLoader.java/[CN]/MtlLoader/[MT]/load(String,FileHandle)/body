{
  String line;
  String[] tokens;
  String curMatName="default";
  Color difcolor=Color.WHITE;
  Color speccolor=Color.WHITE;
  String texFilename=null;
  FileHandle file=Gdx.files.internal(name);
  if (file == null || file.exists() == false)   return;
  BufferedReader reader=new BufferedReader(new InputStreamReader(file.read()),4096);
  try {
    while ((line=reader.readLine()) != null) {
      if (line.length() > 0 && line.charAt(0) == '\t')       line=line.substring(1).trim();
      tokens=line.split("\\s+");
      if (tokens[0].length() == 0) {
        continue;
      }
 else       if (tokens[0].charAt(0) == '#')       continue;
 else       if (tokens[0].toLowerCase().equals("newmtl")) {
        ModelMaterial mat=new ModelMaterial();
        mat.id=curMatName;
        mat.diffuse=new Color(difcolor);
        mat.specular=new Color(speccolor);
        if (texFilename != null) {
          ModelTexture tex=new ModelTexture();
          tex.fileName=new String(texFilename);
          if (mat.diffuseTextures == null)           mat.diffuseTextures=new Array<ModelTexture>(1);
          mat.diffuseTextures.add(tex);
        }
        materials.add(mat);
        if (tokens.length > 1) {
          curMatName=tokens[1];
          curMatName=curMatName.replace('.','_');
        }
 else         curMatName="default";
        difcolor=Color.WHITE;
        speccolor=Color.WHITE;
      }
 else       if (tokens[0].toLowerCase().equals("kd") || tokens[0].toLowerCase().equals("ks")) {
        float r=Float.parseFloat(tokens[1]);
        float g=Float.parseFloat(tokens[2]);
        float b=Float.parseFloat(tokens[3]);
        float a=1;
        if (tokens.length > 4)         a=Float.parseFloat(tokens[4]);
        if (tokens[0].toLowerCase().equals("kd")) {
          difcolor=new Color();
          difcolor.set(r,g,b,a);
        }
 else {
          speccolor=new Color();
          speccolor.set(r,g,b,a);
        }
      }
 else       if (tokens[0].toLowerCase().equals("map_kd")) {
        String textureName=tokens[1];
        if (textureName.length() > 0) {
          texFilename=textureDir.child(textureName).toString();
        }
 else         texFilename=null;
      }
    }
    reader.close();
  }
 catch (  IOException e) {
    return;
  }
  ModelMaterial mat=new ModelMaterial();
  mat.id=curMatName;
  mat.diffuse=new Color(difcolor);
  mat.specular=new Color(speccolor);
  if (texFilename != null) {
    ModelTexture tex=new ModelTexture();
    tex.fileName=new String(texFilename);
    if (mat.diffuseTextures == null)     mat.diffuseTextures=new Array<ModelTexture>(1);
    mat.diffuseTextures.add(tex);
  }
  materials.add(mat);
  return;
}
