{
  FontState fontState=evalFontState(as);
  x+=fontState.offsetX;
  y+=fontState.offsetY;
  int numLines;
  if (!bitmapFont.prepare()) {
    return 0;
  }
  try {
    renderer.tintStack.setColor(fontState.color);
    numLines=bitmapFont.drawMultiLineText(x,y,str,width,align);
  }
  finally {
    bitmapFont.cleanup();
  }
  return numLines * bitmapFont.getLineHeight();
}
