{
  try {
    boolean setup=bitstream == null;
    if (setup) {
      bitstream=new Bitstream(file.read());
      outputBuffer=new OutputBuffer(2,false);
      decoder=new MP3Decoder();
      decoder.setOutputBuffer(outputBuffer);
    }
    int totalLength=0;
    int minRequiredLength=buffer.length - OutputBuffer.BUFFERSIZE * 2 - 1;
    while (totalLength < minRequiredLength) {
      Header header=bitstream.readFrame();
      if (header == null)       break;
      if (setup) {
        setup(outputBuffer.isStereo() ? 2 : 1,header.getSampleRate());
        setup=false;
      }
      try {
        decoder.decodeFrame(header,bitstream);
      }
 catch (      Exception ignored) {
      }
      bitstream.closeFrame();
      int length=outputBuffer.reset();
      System.arraycopy(outputBuffer.getBuffer(),0,buffer,totalLength,length);
      totalLength+=length;
    }
    return totalLength;
  }
 catch (  Throwable ex) {
    reset();
    throw new GdxRuntimeException("Error reading audio data.",ex);
  }
}
